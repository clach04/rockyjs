<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Simple Example</title>

    <!-- build:template
    <script src="../../<%= rockyjs_path %>"></script>
    /build -->
    <!-- build:remove -->
    <!-- this template/remove construct is a workaround as processhtml doesn't support variables for values -->
    <script src="../../src/html-binding.js"></script>
    <script src="../../src/symbols-manual.js"></script>
    <script src="../../src/symbols-generated.js"></script>
    <script src="../../src/transpiled.js"></script>
    <!-- /build -->

    <!-- build:css ../../css/bootstrap.min.css -->
    <link href="../../html/css/bootstrap.min.css" rel="stylesheet">
    <!-- /build -->
    <!-- build:css ../../css/style.css -->
    <link href="../../html/css/style.css" rel="stylesheet">
    <!-- /build -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="../common/css/style.css">
</head>
<body>
<div class="container">
    <div class="page-header">
        <h1>Text Example</h1>
        <p class="lead">
            This example demostrates the APIs around text rendering and fonts.
        </p>
    </div>

    <div class="col-md-6">
    <!
        <canvas id="pebble" class="rocky" width="432" height="504"></canvas>
    -->
        <canvas id="pebble" class="rocky" width="144" height="168"></canvas>
    </div>

    <div class="col-md-6">
        <h2>What's going on?</h2>
        <p>
            Similar to the <a href="../simple">simple example</a> it binds Rocky.js to a canvas, and update the output at a regular interval.
        </p>
        <p>
            This example uses <code>fonts_get_system_font()</code> to load one of Pebble's system fonts,
            as well as <code>fonts_load_custom_font()</code> and <code>fonts_load_custom_font_with_data()</code> to load custom fonts.
            Read more about <a href="https://developer.pebble.com/guides/pebble-apps/resources/font-resources/#font-compatibility-note">custom fonts at the developer documentation page</a>.
        </p>
    </div>
    <!-- build:template
    <%= github_banner %>
    /build -->
</div>
</body>

<script>
    (function () {
        var rocky = Rocky.bindCanvas(document.getElementById("pebble"));
        // puts all C-symbols from rocky onto window.* so they can be used almost
        // the same way you were using them in C
        rocky.export_global_c_symbols();

        // OSP-DIN at 10pt taken from https://github.com/pebble-examples/feature-custom-font
        var fontData = atob("AxCNAK8l/wIKAQAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAEAACEBBAAiAQgAIwAMACQADAAlAQwAJgAQACcBEAAoARQAKQEYACoAHAArARwALAEgAC0BJAAuASgALwEsADABMAAxATQAMgE4ADMBPAA0AUAANQFEADYBSAA3AUwAOAFQADkBVAA6AVgAOwFcADwBYAA9AWQAPgFoAD8BbABAAXAAQQF0AEIBeABDAXwARAGAAEUBhABGAYgARwGMAEgBkABJAZQASgGYAEsBnABMAaAATQGkAE4BqABPAawAUAGwAFEBtABSAbgAUwK8AFQCxABVAcwAVgHQAFcB1ABYAdgAWQHcAFoB4ABbAeQAXAHoAF0B7ABeAfAAXwD0AGAB9ABhAfgAYgH8AGMBAAFkAQQBZQEIAWYBDAFnARABaAEUAWkBGAFqARwBawEgAWwBJAFtASgBbgEsAW8BMAFwATQBcQE4AXIBPAFzAUABdAFEAXUBSAF2AUwBdwFQAXgBVAF5AVgBegFcAXsBYAF8AWQBfQFoAX4BbAF/AHABgABwAYEAcAGCAHABgwBwAYQAcAGFAHABhgBwAYcAcAGIAHABiQBwAYoAcAGLAHABjABwAY0AcAGOAHABjwBwAZAAcAGRAHABkgBwAZMAcAGUAHABlQBwAZYAcAGXAHABmABwAZkAcAGaAHABmwBwAZwAcAGdAHABngBwAZ8AcAGgAHABoQFwAaIAdAGjAHQBpAB0AaUAdAGmAHQBpwB0AagAdAGpAHQBqgB0AasBdAGsAHgBrQB4Aa4AeAGvAHgBsAB4AbEAeAGyAHgBswB4AbQAeAG1AHgBtgB4AbcAeAG4AXgBuQB8AboAfAG7AXwBvACAAb0AgAG+AIABvwGAAcABhAHBAYgBwgGMAcMAkAHEAZABxQCUAcYBlAHHAJgByAGYAckBnAHKAaABywGkAcwBqAHNAawBzgGwAc8BtAHQALgB0QC4AdIBuAHTAbwB1ALAAdUByAHWAcwB1wHQAdgA1AHZAdQB2gHYAdsB3AHcAeAB3QDkAd4A5AHfAOQB4AHkAeEB6AHiAewB4wDwAeQB8AHlAPQB5gH0AecB+AHoAfwB6QEAAuoBBALrAQgC7AEMAu0BEALuARQC7wEYAvAAHALxABwC8gEcAvMBIAL0ASQC9QAoAvYBKAL3ACwC+AAsAvkBLAL6ADAC+wEwAvwANAL9ADQC/gA0AiAACQAhAA4AIgAXACUAIAAnADEAKAA6ACkARwArAFQALABhAC0AagAuAHMALwB8ADAAiQAxAJYAMgCjADMAsAA0AL0ANQDKADYA1wA3AOQAOADxADkA/gA6AAsBOwAUATwAHQE9ACYBPgAvAT8AOAFAAEkBQQBOAUIAXwFDAGwBRAB5AUUAhgFGAJMBRwCgAUgArQFJALoBSgDDAUsA0AFMAN0BTQDqAU4A+wFPAAgCUAAVAlEAIgJSADMCUwBAAlIBKwdUAE0CUwFAB1UAWgJWAGcCVwB4AlgAjQJZAJ4CWgCvAlsAvAJcAMkCXQDWAl4A4wJgAOwCYQD1AmIAAgNjAA8DZAAcA2UAKQNmADYDZwBDA2gAUANpAF0DagBmA2sAcwNsAIADbQCNA24AmgNvAKcDcAC0A3EAwQNyAM4DcwDbA3QA6AN1APUDdgACBHcADwR4ABwEeQApBHoANgR7AEMEfABQBH0AWQR+AGYEoQBvBKsAeAS4AIUEuwCOBL8AmwTAAKwEwQC9BMIAzgTEAN8ExgDwBMgABQXJABYFygAnBcsAOAXMAEkFzQBWBc4AYwXPAHQF0gCFBdMAlgXUAKcFryUEANUAuAXWAMUF1wDSBdkA2wXaAOwF2wD9BdwADgbgAB8G4QAsBuIAOQbkAEYG5gBTBucAYAboAG0G6QB6BuoAhwbrAJQG7AChBu0ArgbuALsG7wDMBvIA3QbzAOoG9AD3BvYABAf5ABEH+wAeBwAAAAAAAAAQBgAAABADAQsBBQP/BQAAAwEBBQUHAAAABQ0BBQdzrUUIIULrnAEAAAACAQEFBAMAAAADDQEFBbS2bZtEAAAAAw0ABQSZbNu2FgAAAAYGAQkIDPMzDAMAAAACAwEOBB8AAAAEAQEKBg8AAAACAQEPBAMAAAAEDwADBIjMRERmJiIDBQsBBQdu77333ns7AAMLAQUGvm3btgEAAAAFCwEFB25jzJgxZnwABQsBBQdub4wZxns7AAULAQUHxBhjxN4fYwAFCwEF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");
        var font1 = fonts_load_custom_font_with_data(fontData);
        var font2 = fonts_get_system_font(FONT_KEY_GOTHIC_18);
        var font3 = fonts_load_custom_font({height: 40, url:"https://github.com/pebble-examples/feature-custom-font/raw/master/resources/fonts/osp-din/OSP-DIN.ttf"});

        var BG_IMAGE=null;
        //var BG_IMAGE=gbitmap_create('https://raw.githubusercontent.com/clach04/watchface_storm_trooper/vector_opaque/resources/images/storm_trooper.png');

        var value = 0;
        rocky.update_proc = function (ctx, bounds) {
            /* text_layer_create(), etc. as of early Feb 2016 not yet implemented */
            /* Rectablge (Basalt)  NOT Round */

            var FONT_SYSTEM_NAME=FONT_KEY_ROBOTO_BOLD_SUBSET_49;
            var DEFAULT_BACKGROUND_COLOR=GColorBlack;
            //var DEFAULT_TIME_COLOR=GColorRed;
            var DEFAULT_TIME_COLOR=GColorWhite;
            var background_color=DEFAULT_BACKGROUND_COLOR;
            /* TODO custom font support */

            /* Date */
            var FONT_DATE_SYSTEM_NAME=FONT_KEY_GOTHIC_18_BOLD;
            var font_date=fonts_get_system_font(FONT_DATE_SYSTEM_NAME);
            var DATE_POS=GRect(0, 140, 144, 168);
            var DATE_ALIGN=GTextAlignmentRight;
            var date_str="Thu, 20 Aug";  // FIXME use current date

            /* Bluetooth */
            var FONT_BT_SYSTEM_NAME=FONT_KEY_GOTHIC_18;
            var font_bt=fonts_get_system_font(FONT_BT_SYSTEM_NAME);
            var BT_ALIGN=GTextAlignmentCenter;
            var BT_POS=GRect(0, 120, 144, 168);
            var BLUETOOTH_DISCONNECTED_STR="BT Disconnected";

            /* Battery */
            var FONT_BAT_SYSTEM_NAME=FONT_KEY_GOTHIC_18;
            var font_bat=fonts_get_system_font(FONT_BAT_SYSTEM_NAME);
            var BAT_POS=GRect(0, 140, 144, 168);
            var BAT_ALIGN=GTextAlignmentLeft;
            var battery_str="Bat: 100%";

            /* Time */
            var CLOCK_POS=GRect(0, 52, 144, 168);
            var TIME_ALIGN=GTextAlignmentCenter;
            var time_str="22:55";  // FIXME use current time
            var time_font=fonts_get_system_font(FONT_SYSTEM_NAME);

            /* Health */
            var time_color=DEFAULT_TIME_COLOR;
            var HEALTH_POS=GRect(0, 40, 144, 168);
            var HEALTH_ALIGN=GTextAlignmentCenter;
            var health_steps_str="123456 steps today";

            /* Bitmap logo */
            // Stormstrooper https://github.com/clach04/watchface_storm_trooper
            var IMAGE_RES_X=125;
            var IMAGE_RES_Y=132;
            var BG_IMAGE_GRECT=GRect((144 - IMAGE_RES_X) / 2, 0,  IMAGE_RES_X, IMAGE_RES_Y);

            graphics_context_set_fill_color(ctx, background_color);
            graphics_fill_rect(ctx, bounds, 0, GCornerNone);  // Fill background color, as if text background was set
            graphics_context_set_text_color(ctx, time_color);

            if (BG_IMAGE !== null)
            {
                // this file might not load successfully, draw a placeholder beneath it
                if (BG_IMAGE.status != 'loaded')
                {
                    graphics_draw_rect(ctx, BG_IMAGE_GRECT);
                }
                else
                {
                    graphics_draw_bitmap_in_rect(ctx, BG_IMAGE, BG_IMAGE_GRECT);
                }
            }

            graphics_draw_text(ctx, health_steps_str, font_date, HEALTH_POS, 0, HEALTH_ALIGN);
            graphics_draw_text(ctx, date_str, font_date, DATE_POS, 0, DATE_ALIGN);
            graphics_draw_text(ctx, battery_str, font_bat, BAT_POS, 0, BAT_ALIGN);
            graphics_draw_text(ctx, BLUETOOTH_DISCONNECTED_STR, font_bt, BT_POS, 0, BT_ALIGN);

            graphics_draw_text(ctx, time_str, time_font, CLOCK_POS, 0, TIME_ALIGN);

        };

        setInterval(function () {rocky.mark_dirty();}, 1000);  // Update once per sec

    })();
</script>
</html>
